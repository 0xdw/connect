<!DOCTYPE html><html><head><title>Connect - High quality middleware for node.js</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" href="style.css"><script src="jquery.js"></script><script src="docs.js"></script></head><body><div id="content"><h1>Connect</h1><div id="module.exports" class="comment"><h2></h2><div class="description"><h2>Anti CSRF</h2>

<p>CRSF protection middleware.</p>

<p>By default this middleware generates a token named "_csrf"<br />which should be added to requests which mutate<br />state, within a hidden form field, query-string etc. This<br />token is validated against the visitor's <code>req.session._csrf</code><br />property.</p>

<p>The default <code>value</code> function checks <code>req.body</code> generated<br />by the <code>bodyParser()</code> middleware, <code>req.query</code> generated<br />by <code>query()</code>, and the "X-CSRF-Token" header field.</p>

<p>This middleware requires session support, thus should be added<br />somewhere <em>below</em> <code>session()</code> and <code>cookieParser()</code>.</p>

<h2>Options</h2>

<ul>
<li><code>value</code> a function accepting the request, returning the token </li>
</ul></div><ul class="tags"><li><em>Object</em> options </li></ul><h3>Source</h3><pre><code>module.exports = function csrf(options) {
  var options = options || {}
    , value = options.value || defaultValue;

  return function(req, res, next){
    // generate CSRF token
    var token = req.session._csrf || (req.session._csrf = utils.uid(24));

    // ignore these methods
    if ('GET' == req.method || 'HEAD' == req.method || 'OPTIONS' == req.method) return next();

    // determine value
    var val = value(req);

    // check
    if (val != token) return next(utils.error(403));
    
    next();
  }
};</code></pre></div><div id="defaultValue" class="comment"><h2>defaultValue()</h2><div class="description"><p>Default value function, checking the <code>req.body</code><br />and <code>req.query</code> for the CSRF token.</p></div><ul class="tags"><li><em>IncomingMessage</em> req </li><li>returns <em>String</em> </li></ul><h3>Source</h3><pre><code>function defaultValue(req) {
  return (req.body && req.body._csrf)
    || (req.query && req.query._csrf)
    || (req.headers['x-csrf-token']);
}</code></pre></div></div><ul id="menu"><li><a href="#module.exports"></a></li><li><a href="#defaultValue">defaultValue()</a></li></ul></body></html>