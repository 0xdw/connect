<html>
  <head>
    <title>
      
        Connect - errorHandler
      
    </title>
    <link rel='stylesheet' href='main.css' />
  </head>
  <body>
    <div id="content">
      
        <h1>errorHandler</h1>
        <span class="filename">lib/middleware/errorHandler.js</span>
      

      
      
        
        
        
        
          <div class="comment">
            
            <p class="description"><p>Flexible error handler, providing (<em>optional</em>) stack traces
and error message responses for requests accepting text, html,
or json.</p></p>

            
              <div class="body">
                <h2>Options</h2>

<ul><li><code>showStack</code>, <code>stack</code> respond with both the error message and stack trace. Defaults to <code>false</code></li><li><code>showMessage</code>, <code>message</code>, respond with the exception message only. Defaults to <code>false</code></li><li><code>dumpExceptions</code>, <code>dump</code>, dump exceptions to stderr (without terminating the process). Defaults to <code>false</code></li></ul>

<h2>Text</h2>

<p>  By default, and when <em>text/plain</em> is accepted a simple stack trace
  or error message will be returned.</p>

<h2>JSON</h2>

<p>  When <em>application/json</em> is accepted, connect will respond with
  an object in the form of <code>{ "error": error }</code>. </p>

<h2>HTML</h2>

<p>  When accepted connect will output a nice html stack trace.</p>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">Object</span> <span class="name">options</span> <span class="description"></span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Function</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
<span class="variable">exports</span> = <span class="variable">module</span>.<span class="variable">exports</span> = <span class="keyword">function</span> <span class="variable">errorHandler</span>(<span class="variable">options</span>){
  <span class="variable">options</span> = <span class="variable">options</span> || {};

  <span class="comment">// defaults</span>
  <span class="keyword">var</span> <span class="variable">showStack</span> = <span class="variable">options</span>.<span class="variable">showStack</span> || <span class="variable">options</span>.<span class="variable">stack</span>
    , <span class="variable">showMessage</span> = <span class="variable">options</span>.<span class="variable">showMessage</span> || <span class="variable">options</span>.<span class="variable">message</span>
    , <span class="variable">dumpExceptions</span> = <span class="variable">options</span>.<span class="variable">dumpExceptions</span> || <span class="variable">options</span>.<span class="variable">dump</span>
    , <span class="variable">formatUrl</span> = <span class="variable">options</span>.<span class="variable">formatUrl</span>;

  <span class="keyword">return</span> <span class="keyword">function</span> <span class="variable">errorHandler</span>(<span class="variable">err</span>, <span class="variable">req</span>, <span class="variable">res</span>, <span class="variable">next</span>){
    <span class="variable">res</span>.<span class="variable">statusCode</span> = <span class="number integer">500</span>;
    <span class="keyword">if</span> (<span class="variable">dumpExceptions</span>) <span class="variable">console</span>.<span class="variable">error</span>(<span class="variable">err</span>.<span class="variable">stack</span>);
    <span class="keyword">if</span> (<span class="variable">showStack</span>) {
      <span class="keyword">var</span> <span class="variable">accept</span> = <span class="variable">req</span>.<span class="variable">headers</span>.<span class="variable">accept</span> || <span class="string">''</span>;
      <span class="comment">// html</span>
      <span class="keyword">if</span> (~<span class="variable">accept</span>.<span class="variable">indexOf</span>(<span class="string">'html'</span>)) {
        <span class="variable">fs</span>.<span class="variable">readFile</span>(<span class="variable">__dirname</span> + <span class="string">'/../public/style.css'</span>, <span class="string">'utf8'</span>, <span class="keyword">function</span>(<span class="variable">e</span>, <span class="variable">style</span>){
          <span class="variable">fs</span>.<span class="variable">readFile</span>(<span class="variable">__dirname</span> + <span class="string">'/../public/error.html'</span>, <span class="string">'utf8'</span>, <span class="keyword">function</span>(<span class="variable">e</span>, <span class="variable">html</span>){
            <span class="keyword">var</span> <span class="variable">stack</span> = <span class="variable">err</span>.<span class="variable">stack</span>
              .<span class="variable">split</span>(<span class="string">'\n'</span>).<span class="variable">slice</span>(<span class="number integer">1</span>)
              .<span class="variable">map</span>(<span class="keyword">function</span>(<span class="variable">v</span>){ <span class="keyword">return</span> <span class="string">'<li>'</span> + <span class="variable">v</span> + <span class="string">'</li>'</span>; }).<span class="variable">join</span>(<span class="string">''</span>);
              <span class="variable">html</span> = <span class="variable">html</span>
                .<span class="variable">replace</span>(<span class="string">'{style}'</span>, <span class="variable">style</span>)
                .<span class="variable">replace</span>(<span class="string">'{stack}'</span>, <span class="variable">stack</span>)
                .<span class="variable">replace</span>(<span class="string">'{title}'</span>, <span class="variable">exports</span>.<span class="variable">title</span>)
                .<span class="variable">replace</span>(<span class="regexp">/\{error\}/g</span>, <span class="variable">err</span>.<span class="variable">toString</span>());
              <span class="variable">res</span>.<span class="variable">setHeader</span>(<span class="string">'Content-Type'</span>, <span class="string">'text/html'</span>);
              <span class="variable">res</span>.<span class="variable">end</span>(<span class="variable">html</span>);
          });
        });
      <span class="comment">// json</span>
      } <span class="keyword">else</span> <span class="keyword">if</span> (~<span class="variable">accept</span>.<span class="variable">indexOf</span>(<span class="string">'json'</span>)) {
        <span class="keyword">var</span> <span class="variable">json</span> = <span class="class">JSON</span>.<span class="variable">stringify</span>({ <span class="variable">error</span>: <span class="variable">err</span> });
        <span class="variable">res</span>.<span class="variable">setHeader</span>(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);
        <span class="variable">res</span>.<span class="variable">end</span>(<span class="variable">json</span>);
      <span class="comment">// plain text</span>
      } <span class="keyword">else</span> {
        <span class="variable">res</span>.<span class="variable">writeHead</span>(<span class="number integer">500</span>, { <span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span> });
        <span class="variable">res</span>.<span class="variable">end</span>(<span class="variable">err</span>.<span class="variable">stack</span>);
      }
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> <span class="variable">body</span> = <span class="variable">showMessage</span>
        ? <span class="variable">err</span>.<span class="variable">toString</span>()
        : <span class="string">'Internal Server Error'</span>;
      <span class="variable">res</span>.<span class="variable">setHeader</span>(<span class="string">'Content-Type'</span>, <span class="string">'text/plain'</span>);
      <span class="variable">res</span>.<span class="variable">end</span>(<span class="variable">body</span>);
    }
  };
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
      
    </div>
  </body>
</html>