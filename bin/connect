#!/usr/bin/env node

/*!
 * Ext JS Connect
 * Copyright(c) 2010 Ext JS, Inc.
 * MIT Licensed
 */

/**
 * Module dependencies.
 */

var sys = require('sys'),
    fs = require('fs');

/**
 * Argument vector.
 */

var args = process.ARGV.slice(2);

/**
 * Usage documentation.
 */

var usage = ''
    + 'Usage: connect [options] start|stop|restart\n'
    + '\n'
    + 'Options:\n'
    + '  -H, --host [addr]     Host address, defaults to "0.0.0.0"\n'
    + '  -p, --port [num]      Port number, defaults to 3000\n'
    + '  -I, --include <path>  Unshift the given path to require.paths\n'
    + '  -e, --eval <code>     Evaluate the given string\n'
    + '  -h, --help            Display help information\n';

/**
 * Exit with the given message.
 *
 * @param  {String} msg
 * @param  {Number} code
 */

function abort(msg, code){
    sys.error(msg);
    process.exit(code || 1);
}

/**
 * Return shifted argument, or
 * abort with the given errMsg.
 *
 * @param  {String} errMsg
 * @return {String}
 */

function shift(errMsg){
    if (args.length) {
        return args.shift();
    } else {
        abort(errMsg);
    }
}

/**
 * Parse the arguments.
 */

(function parseArguments(){
    var arg = args.shift();
    switch (arg) {
        case '-h':
        case '--help':
            abort(usage);
            break;
        case '-I':
        case '--include':
            require.paths.unshift(shift('--include requires a path.'));
            break;
        case '-e':
        case '--eval':
            eval(shift('--eval requires a string.'));
            break;
        default:
            abort('start, stop, or restart required');
    }
})();