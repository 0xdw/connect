<html>
  <head>
    <title>
      
        Connect - logger
      
    </title>
    <link rel='stylesheet' href='main.css' />
  </head>
  <body>
    <div id="content">
      
        <h1>logger</h1>
        <span class="filename">lib/middleware/logger.js</span>
      

      
      
        
        
        
        
        
          <div class="comment">
            
            <p class="description"><p>Log requests with the given <code>options</code> or a <code>format</code> string.</p></p>

            
              <div class="body">
                <h2>Options</h2>

<ul><li><code>format</code>  Format string, see below for tokens</li><li><code>stream</code>  Output stream, defaults to <em>stdout</em></li><li><code>buffer</code>  Buffer duration, defaults to 1000ms when <em>true</em></li></ul>

<h2>Tokens</h2>

<ul><li><code>:req[header]</code> ex: <code>:req[Accept]</code></li><li><code>:res[header]</code> ex: <code>:res[Content-Length]</code></li><li><code>:http-version</code></li><li><code>:response-time</code></li><li><code>:remote-addr</code></li><li><code>:date</code></li><li><code>:method</code></li><li><code>:url</code></li><li><code>:referrer</code></li><li><code>:user-agent</code></li><li><code>:status</code></li></ul>
              </div>
            

            
              <ul class="tags">
              
                

                

                

                
                  <li class="param"><em>param</em> <span class="types">String, Function, Object</span> <span class="name">format</span> <span class="description">or options</span></li>
                
              
                
                  <li class="return"><em>returns</em> <span class="types">Function</span></li>
                

                

                

                
              
                

                
                  <li class="api"><em>api</em> <span class="visibility">public</span></li>
                

                

                
              
              </ul>

<!--            
              <pre class="code">
                <code>
module.exports = function logger(options) {
  if ('object' == typeof options) {
    options = options || {};
  } else if (options) {
    options = { format: options };
  } else {
    options = {};
  }

  var fmt = options.format
    , stream = options.stream || process.stdout
    , buffer = options.buffer;

  // buffering support
  if (buffer) {
    var realStream = stream
      , interval = 'number' == typeof buffer
        ? buffer
        : defaultBufferDuration;

    // flush interval
    setInterval(function(){
      if (buf.length) {
        realStream.write(buf.join(''), 'ascii');
        buf.length = 0;
      }
    }, interval); 

    // swap the stream
    stream = {
      write: function(str){
        buf.push(str);
      }
    };
  }

  return function logger(req, res, next) {
    var start = +new Date
      , statusCode
      , writeHead = res.writeHead
      , end = res.end
      , url = req.originalUrl;

    // mount safety
    if (req._logging) return next();

    // flag as logging
    req._logging = true;

    // proxy for statusCode.
    res.writeHead = function(code, headers){
      res.writeHead = writeHead;
      res.writeHead(code, headers);
      res.__statusCode = statusCode = code;
      res.__headers = headers || {};
    };

    // proxy end to output a line to the provided logger.
    if (fmt) {
      res.end = function(chunk, encoding) {
        res.end = end;
        res.end(chunk, encoding);
        res.responseTime = +new Date - start;
        if ('function' == typeof fmt) {
          var line = fmt(req, res, function(str){ return format(str, req, res); });
          if (line) stream.write(line + '\n', 'ascii');
        } else {
          stream.write(format(fmt, req, res) + '\n', 'ascii');
        }
      };
    } else {
      res.end = function(chunk, encoding) {
        var contentLength = (res._headers && res._headers['content-length'])
          || (res.__headers && res.__headers['Content-Length'])
          || '-';

        res.end = end;
        res.end(chunk, encoding);

        stream.write((req.socket && (req.socket.remoteAddress || (req.socket.socket && req.socket.socket.remoteAddress)))
           + ' - - [' + (new Date).toUTCString() + ']'
           + ' "' + req.method + ' ' + url
           + ' HTTP/' + req.httpVersionMajor + '.' + req.httpVersionMinor + '" '
           + (statusCode || res.statusCode) + ' ' + contentLength
           + ' "' + (req.headers['referer'] || req.headers['referrer'] || '')
           + '" "' + (req.headers['user-agent'] || '') + '"\n', 'ascii');
      };
    }

    next();
  };
};
                </code>
              </pre>
             -->
          
          </div>
        
      
        
      
    </div>
  </body>
</html>