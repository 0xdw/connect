<!DOCTYPE html><html><head><title>Connect - High quality middleware for node.js</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="stylesheet" href="style.css"><script src="jquery.js"></script><script src="docs.js"></script></head><body><div id="content"><h1>Connect</h1><p>High quality middleware for node.js</p><div id="module.exports" class="comment"><h2></h2><div class="description"><h2>Limit</h2>

<p>Limit request bodies to the given size in <code>bytes</code>.</p>

<p>A string representation of the bytesize may also be passed,<br />  for example "5mb", "200kb", "1gb", etc.</p>

<pre><code>connect()
  .use(connect.limit('5.5mb'))
  .use(handleImageUpload)
</code></pre></div><ul class="tags"><li><em>Number | String</em> bytes </li><li>returns <em>Function</em> </li></ul><h3>Source</h3><pre><code>module.exports = function limit(bytes){
  if ('string' == typeof bytes) bytes = parse(bytes);
  if ('number' != typeof bytes) throw new Error('limit() bytes required');
  return function limit(req, res, next){
    var received = 0
      , len = req.headers['content-length']
        ? parseInt(req.headers['content-length'], 10)
        : null;

    // self-awareness
    if (req._limit) return next();
    req._limit = true;

    // limit by content-length
    if (len && len > bytes) return next(utils.error(413));

    // limit
    req.on('data', function(chunk){
      received += chunk.length;
      if (received > bytes) req.destroy();
    });

    next();
  };
};</code></pre></div><div id="parse" class="comment"><h2>parse()</h2><div class="description"><p>Parse byte <code>size</code> string.</p></div><ul class="tags"><li><em>String</em> size </li><li>returns <em>Number</em> </li></ul><h3>Source</h3><pre><code>function parse(size) {
  var parts = size.match(/^(\d+(?:\.\d+)?) *(kb|mb|gb)$/)
    , n = parseFloat(parts[1])
    , type = parts[2];

  var map = {
      kb: 1024
    , mb: 1024 * 1024
    , gb: 1024 * 1024 * 1024
  };

  return map[type] * n;
}</code></pre></div></div><ul id="menu"><li><a href="#module.exports"></a></li><li><a href="#parse">parse()</a></li></ul></body></html>